#!/usr/bin/env bash

source utils/create-backups
source utils/stow-packages
source utils/parse-targets

PACKAGES="$(find 'packages/' -maxdepth 1 -mindepth 1 -type d | cut -d / -f 2)"
declare -A TARGETS="($(parse-targets packages.yaml))"

main() {
	# Stow packages
	create-backups "$PACKAGES" TARGETS
	stow-packages "$PACKAGES" TARGETS

	# Reload bash
	exec bash
}

main
